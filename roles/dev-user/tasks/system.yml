---
- name: install common development packages
  apt:
    name: "{{ dev_user_system_packages }}"


- name: pid in core dump file names for multi-threaded debugging
  sysctl:
    name: kernel.core_uses_pid
    value: 1
    state: present
    sysctl_file: /etc/sysctl.d/77-debug.conf

- name: enable sys-req debugging of the kernel
  sysctl:
    name: kernel.sysrq
    value: 0
    state: absent
    sysctl_file: /etc/sysctl.d/77-debug.conf

- name: record public keys of known hosts
  known_hosts:
    path: /etc/ssh/ssh_known_hosts
    # 1st expression:
    #   host      -> host
    #   host:port -> [host]:port
    name: "{{ (':' in item) | ternary('[' + item | regex_replace(':',']:'), item) }}"
    # 2nd expression:
    #   host      -> ssh-keyscan -t rsa -p 22   host
    #   host:port -> ssh-keyscan -t rsa -p port host
    key: "{{ lookup( 'pipe', 'ssh-keyscan -t rsa -p '
                           + ((item + ':22') | regex_search(':[0-9]+'))[1:]
                           + ' ' + (item | regex_replace(':.*')) ) }}"
  loop: "{{ dev_user_known_host_list }}"
  tags: dev_user_known_hosts
...
