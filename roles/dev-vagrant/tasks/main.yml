---
# tasks file for ivansible.dev_vagrant

- name: refresh host info
  setup:

- name: vagrant from ppa (not recommended)
  apt:
    name: vagrant
  become: yes
  when: vagrant_package_url == 'ppa'
  register: vagrant_ppa_result
  tags:
  - dev_vaginstall
  - dev_vagrant

- import_tasks: vagrant.yml
  become: yes
  when: vagrant_package_url != 'ppa'
  tags:
  - dev_vaginstall
  - dev_vagrant

- import_tasks: plugins.yml
  become: no
  when: vagrant_plugin_list |length > 0
  tags:
  - dev_vagplugins
  - dev_vagrant

- name: authenticate with vagrant cloud
  # use transient environment variable to hide token from command line
  shell: vagrant login -t $_vagrant_cloud_token
  args:
    creates: ~/.vagrant.d/data/vagrant_login_token
  environment:
    _vagrant_cloud_token: "{{ vagrant_cloud_token }}"
  become: no
  when: vagrant_cloud_token != ''
  tags:
  - dev_vaglogin
  - dev_vagrant

- name: checkout vagrant files, if permitted
  git:
    dest: "{{ vagrant_files_dir }}"
    repo: "{{ vagrant_files_repo }}"
    version: "{{ vagrant_files_branch }}"
    # only clone, don't choke on pending modifications
    update: no
    accept_hostkey: yes
  when: "vagrant_files_repo != ''
         and 'permitted' in group_names"
  tags:
  - dev_vagrantfiles
  - dev_vagrant
...
